{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anticuario</title>
    <link rel="stylesheet" href="{% static 'styles.css' %}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

    <script>
        $(document).ready(
          function() {
              
              $("#EnvioCorreo").submit(function(){ 
                  var mail =$("#mail").val();
                  var rut =$("#Rut").val();
                  var nombre =$("#Nombre").val();
                  var appaterno =$("#Appaterno").val();
                  var apmaterno =$("#Apmaterno").val();
                  var edad =$("#Edad").val();
                  var sexo =$("#Sexo").val(); 
                  var celular =$("#Celular").val();
                  var comentario =$("#Comentario").val();
    
                  console.log("Mail Obtenido:", mail);
                  console.log("Rut Obtenido:", rut);
                  console.log("Nombre Obtenido:", nombre);
                  console.log("Appaterno Obtenido:", appaterno);
                  console.log("Apmaterno Obtenido:", apmaterno);
                  console.log("Edad Obtenido:", edad);
                  console.log("Sexo Obtenido:", sexo);
                  console.log("Celular Obtenido:", celular);
                  
    
                  var cadenaError="";
                  var cadenaErrLargo=""; 
                  
                  var largoCadenaRut = rut.length;
                  var largoCadenaNombre = nombre.length;
                  var largoCadenaAppaterno = appaterno.length;
                  var largoCadenaApmaterno = apmaterno.length;
                  var largoCadenaCelular = celular.length;
                  var largoCadenaComentario = comentario.length;
    
                  if(mail===""){
                      cadenaError+= "Ingrese el campo Correo.\n";
                  }
                  if(rut===""){
                      cadenaError+= "Ingrese el campo Rut.\n";
                  }
                  if(largoCadenaRut<9 || largoCadenaRut>10){
                      cadenaErrLargo+="Rut no valido. Recuerde escribir el rut en el formato correcto. ej. 99999999-9\n";
                  }
                  
                  if(nombre===""){
                      cadenaError+= "Ingrese el campo nombre.\n";
                  }
                  if(largoCadenaNombre<3 || largoCadenaNombre>20){
                      cadenaErrLargo+="Nombre no valido. Recuerde escribir el Nombre en el formato correcto. NO menos de 3 letras, No más de 20.\n";
                  }
    
                  if(appaterno===""){
                      cadenaError+= "Ingrese el campo appaterno.\n";
                  }
                  if(largoCadenaAppaterno<3 || largoCadenaAppaterno>20){
                      cadenaErrLargo+="Apellido no valido. Recuerde escribir el Apellido en el formato correcto. NO menos de 3 letras, No más de 20.\n";
                  }
    
                  if(apmaterno===""){
                      cadenaError+= "Ingrese el campo apmaterno.\n";
                  }
                  if(largoCadenaApmaterno<3 || largoCadenaApmaterno>20){
                      cadenaErrLargo+="Apellido no valido. Recuerde escribir el Apellido en el formato correcto. NO menos de 3 letras, No más de 20.\n";
                  }
    
                  if(edad===""){
                      cadenaError+= "Ingrese el campo edad.\n";
                  }
                  if(edad<18){
                      cadenaErrLargo+="Edad no valida. Recuerde que la edad minima de compra es de 18 años\n";
                  }
    
                  if(celular===""){
                      cadenaError+= "Ingrese el campo celular.\n";
                  }
                  if(largoCadenaCelular!=8){
                      cadenaErrLargo+="Telefono no valido. Recuerde escribir los 8 digitos de su numero de telefono, el (+56 9) ya está añadido\n";
                  }
    
                  if(largoCadenaComentario>0){
                    if(largoCadenaComentario<20){
                      cadenaErrLargo+= "Comentario no valido. Comentario muy corto (Minimo 20 caracteres).\n";
                      console.log("Comentario Obtenido:", comentario);
                    }
                    if(largoCadenaComentario>500){
                      cadenaErrLargo+= "Comentario no valido. Comentario muy largo (Maximo 500 caracteres).\n";
                      console.log("Comentario Obtenido:", comentario);
                    }
                  }
                  
    
                  if(cadenaError !==""){
                      alert("Formulario NO enviado, revise el dato ingresado o complete las secciones incompletas del formulario\nPor favor, complete los siguientes campos:\n"+ cadenaError);
                  }
                  if(cadenaErrLargo !==""){
                      alert("Formulario NO enviado:\n"+ cadenaErrLargo);
                  }
    
                  else
                    alert("Formulario Enviado, será contactado dentro de los proximos 3 dias habiles para el envío una vez haya cancelado la compra.");
                  
              });          
          }
      );
        
      </script>
    
</head>
<body>
    <!-- Barra superior de la paguina -->
    <header class= "header">
        <div class="logo"> 
          <a href="Anticuario"><img src="{% static '/logo/OIP.jpg' %}" alt="Logo de la pagina"></a>
        </div>
        <nav>
          <ul class="nav_links">
            <li><a href="Etiquetas">Etiquetas</a></li>
            <li><a href="Filtros">Filtros</a></li>
            <li><a href="Ofertas">Ofertas</a></li>
            <li><a href="ServicioAlCliente">ServicioAlCliente</a></li>
          </ul>
        </nav>
        <!--Barra para vista mobile-->
  
        <a onclick="openNav()" href="#" class="menu"><button>Menu</button></a>
        <div class="overlay" id="mobile_menu">
          <a onclick="closeNav()" href="" class="close">&times;</a>
          <div class="overlay_content">
            <a href="Etiquetas">Etiquetas</a>
            <a href="Filtros">Filtros</a>
            <a href="Ofertas">Ofertas</a>
            <a href="ServicioAlCliente">Servicio al cliente</a>
          </div>
        </div>
      </header>

      <!-- Carrito -->

      <div>
  
        <table class="table table-bordered">
          <thead>
            <tr>
              <th scope="row" colspan="3" class="text-center">CARRITO</th>
            </tr>
            <tr>
              <th scope="col">NOMBRE</th>
              <th scope="col">PRECIO</th>
              <th scope="col">CANTIDAD</th>
            </tr>
          </thead>
          <tbody>
          {% if request.session.carrito.items %}
          {% for key, value in request.session.carrito.items %}
            <tr>
              <td>{{value.nombre}}</td>
              <td>{{value.acumulado}}</td>
              <td>{{value.cantidad}}
                <a href="{% url 'Add' value.id_prod %}" class="badge btn btn-dark badge-dark">+</a>
                <a href="{% url 'Sub' value.id_prod %}" class="badge btn btn-dark badge-dark">-</a>
              </td>
            </tr>
          {% endfor %}
          {% else %}
          <tr>
              <td colspan="3">
                  <div class="alert alert-danger text-center"> Sin Productos </div>
              </td>
          </tr>
          {% endif %}
            <tr>
              <th scope="row">Total:</th>
              <td colspan="2">$ {{totalCarrito}}</td>
            </tr>
          </tbody>
        </table>

      </div>

      <div class="modal-footer">
        <div class="col-6"><a href="{% url 'CLS' %}" class="btn btn-danger">Limpiar</a></div>
      </div>
      
    </div>
  </div>
</div>
</div>
<!--Fin de Carrito-->
    
    <main>
        <br> 
        <h2>Complete el formulario para terminar el pedido y proceder al pago</h2>
        <br>
        <div id="EnvioCorreo">
          <form>
          <div class="form-group"> 
              <span class="input-group-text" id="basic-addon1">Correo electrónico: </span>    
              <input type="email" class="form-control" id="mail" aria-describedby="emailHelp" placeholder="Ingrese su correo electrónico">
              <small id="emailHelp" class="form-text text-muted"> We'll never share your email with anyone else.</small>
          </div>
          
          <br>
  
          <div class="input-group flex-nowrap">
              <span class="input-group-text" id="addon-wrapping">Rut: </span>
              <input type="text" class="form-control" id="Rut" placeholder="Ingrese su Rut" aria-label="Username" aria-describedby="addon-wrapping">
          </div>
  
          <br>
          
          <div class="input-group flex-nowrap">
              <span class="input-group-text" id="addon-wrapping">Nombre: </span>
              <input type="text" class="form-control" id="Nombre" placeholder="Ingrese su nombre" aria-label="Username" aria-describedby="addon-wrapping">
          </div>
          
          <br>
  
          <div class="input-group flex-nowrap">
              <span class="input-group-text" id="addon-wrapping">Apellido Paterno: </span>
              <input type="text" class="form-control" id="Appaterno" placeholder="Ingrese su Apellido Paterno" aria-label="Username" aria-describedby="addon-wrapping">
          </div>
          
          <br>
  
          <div class="input-group flex-nowrap">
              <span class="input-group-text" id="addon-wrapping">Apellido Materno: </span>
              <input type="text" class="form-control" id="Apmaterno" placeholder="Ingrese su Apellido Materno" aria-label="Username" aria-describedby="addon-wrapping">
          </div>
  
          <br>
  
          <div class="input-group flex-nowrap">
              <span class="input-group-text" id="addon-wrapping">Edad: </span>
              <input type="number" class="form-control" id="Edad" placeholder="Ingrese su Edad" aria-label="Username" aria-describedby="addon-wrapping">
          </div>
  
          <br>
  
          <div class="input-group flex-nowrap">
              <span class="input-group-text" id="addon-wrapping">Celular: +56 9</span>
              <input type="number" class="form-control" id="Celular" placeholder="Ingrese su Celular" aria-label="Username" aria-describedby="addon-wrapping">
          </div>
  
          <br>
          <div class="input-group">
            <span class="input-group-text">Comentarios para el envio: </span>
            <textarea class="form-control" id="Comentario" aria-label="With textarea" placeholder="Ingresa tu hermoso Comentario"></textarea>
          </div>
          <br>
          {% if request.session.carrito.items %}
            <button class="BotonEnvioCorreo" type="submit">Proceder a la Compra</button>
          {% else %}
            <div class="col-6"><a href="Anticuario" class="btn btn-success">Añade productos al carro</a></div>
          {% endif %}
        </form>
        </div>  
    
    </main>
    
    <script type="text/javascript" src="{% static 'nav.js' %}"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>

</body>
</html>